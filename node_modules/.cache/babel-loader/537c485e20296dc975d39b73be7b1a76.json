{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.history = exports.HistoryItemImpl = void 0;\n\nvar utils_1 = require(\"../utils\");\n\nvar HistoryItemImpl =\n/** @class */\nfunction () {\n  function HistoryItemImpl(item) {\n    this.perform = item.perform;\n    this.negate = item.negate;\n  }\n\n  HistoryItemImpl.create = function (item) {\n    return new HistoryItemImpl(item);\n  };\n\n  return HistoryItemImpl;\n}();\n\nexports.HistoryItemImpl = HistoryItemImpl;\n\nvar HistoryImpl =\n/** @class */\nfunction () {\n  function HistoryImpl() {\n    this.undoStack = [];\n    this.redoStack = [];\n\n    if (!HistoryImpl.instance) {\n      HistoryImpl.instance = this;\n      this.init();\n    }\n\n    return HistoryImpl.instance;\n  }\n\n  HistoryImpl.prototype.init = function () {\n    var _this = this;\n\n    if (typeof window === \"undefined\") return;\n    window.addEventListener(\"keydown\", function (event) {\n      var _a;\n\n      if (!_this.redoStack.length && !_this.undoStack.length || (0, utils_1.shouldRejectKeystrokes)()) {\n        return;\n      }\n\n      var key = (_a = event.key) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n\n      if (event.metaKey && key === \"z\" && event.shiftKey) {\n        _this.redo();\n      } else if (event.metaKey && key === \"z\") {\n        _this.undo();\n      }\n    });\n  };\n\n  HistoryImpl.prototype.add = function (item) {\n    var historyItem = HistoryItemImpl.create(item);\n    this.undoStack.push(historyItem);\n    return historyItem;\n  };\n\n  HistoryImpl.prototype.remove = function (item) {\n    var undoIndex = this.undoStack.findIndex(function (i) {\n      return i === item;\n    });\n\n    if (undoIndex !== -1) {\n      this.undoStack.splice(undoIndex, 1);\n      return;\n    }\n\n    var redoIndex = this.redoStack.findIndex(function (i) {\n      return i === item;\n    });\n\n    if (redoIndex !== -1) {\n      this.redoStack.splice(redoIndex, 1);\n    }\n  };\n\n  HistoryImpl.prototype.undo = function (item) {\n    // if not undoing a specific item, just undo the latest\n    if (!item) {\n      var item_1 = this.undoStack.pop();\n      if (!item_1) return;\n      item_1 === null || item_1 === void 0 ? void 0 : item_1.negate();\n      this.redoStack.push(item_1);\n      return item_1;\n    } // else undo the specific item\n\n\n    var index = this.undoStack.findIndex(function (i) {\n      return i === item;\n    });\n    if (index === -1) return;\n    this.undoStack.splice(index, 1);\n    item.negate();\n    this.redoStack.push(item);\n    return item;\n  };\n\n  HistoryImpl.prototype.redo = function (item) {\n    if (!item) {\n      var item_2 = this.redoStack.pop();\n      if (!item_2) return;\n      item_2 === null || item_2 === void 0 ? void 0 : item_2.perform();\n      this.undoStack.push(item_2);\n      return item_2;\n    }\n\n    var index = this.redoStack.findIndex(function (i) {\n      return i === item;\n    });\n    if (index === -1) return;\n    this.redoStack.splice(index, 1);\n    item.perform();\n    this.undoStack.push(item);\n    return item;\n  };\n\n  HistoryImpl.prototype.reset = function () {\n    this.undoStack.splice(0);\n    this.redoStack.splice(0);\n  };\n\n  return HistoryImpl;\n}();\n\nvar history = new HistoryImpl();\nexports.history = history;\nObject.freeze(history);","map":{"version":3,"sources":["/Users/DhritiGabani/personal-web/node_modules/kbar/lib/action/HistoryImpl.js"],"names":["Object","defineProperty","exports","value","history","HistoryItemImpl","utils_1","require","item","perform","negate","create","HistoryImpl","undoStack","redoStack","instance","init","prototype","_this","window","addEventListener","event","_a","length","shouldRejectKeystrokes","key","toLowerCase","metaKey","shiftKey","redo","undo","add","historyItem","push","remove","undoIndex","findIndex","i","splice","redoIndex","item_1","pop","index","item_2","reset","freeze"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.history = exports.HistoryItemImpl = void 0;\nvar utils_1 = require(\"../utils\");\nvar HistoryItemImpl = /** @class */ (function () {\n    function HistoryItemImpl(item) {\n        this.perform = item.perform;\n        this.negate = item.negate;\n    }\n    HistoryItemImpl.create = function (item) {\n        return new HistoryItemImpl(item);\n    };\n    return HistoryItemImpl;\n}());\nexports.HistoryItemImpl = HistoryItemImpl;\nvar HistoryImpl = /** @class */ (function () {\n    function HistoryImpl() {\n        this.undoStack = [];\n        this.redoStack = [];\n        if (!HistoryImpl.instance) {\n            HistoryImpl.instance = this;\n            this.init();\n        }\n        return HistoryImpl.instance;\n    }\n    HistoryImpl.prototype.init = function () {\n        var _this = this;\n        if (typeof window === \"undefined\")\n            return;\n        window.addEventListener(\"keydown\", function (event) {\n            var _a;\n            if ((!_this.redoStack.length && !_this.undoStack.length) ||\n                (0, utils_1.shouldRejectKeystrokes)()) {\n                return;\n            }\n            var key = (_a = event.key) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n            if (event.metaKey && key === \"z\" && event.shiftKey) {\n                _this.redo();\n            }\n            else if (event.metaKey && key === \"z\") {\n                _this.undo();\n            }\n        });\n    };\n    HistoryImpl.prototype.add = function (item) {\n        var historyItem = HistoryItemImpl.create(item);\n        this.undoStack.push(historyItem);\n        return historyItem;\n    };\n    HistoryImpl.prototype.remove = function (item) {\n        var undoIndex = this.undoStack.findIndex(function (i) { return i === item; });\n        if (undoIndex !== -1) {\n            this.undoStack.splice(undoIndex, 1);\n            return;\n        }\n        var redoIndex = this.redoStack.findIndex(function (i) { return i === item; });\n        if (redoIndex !== -1) {\n            this.redoStack.splice(redoIndex, 1);\n        }\n    };\n    HistoryImpl.prototype.undo = function (item) {\n        // if not undoing a specific item, just undo the latest\n        if (!item) {\n            var item_1 = this.undoStack.pop();\n            if (!item_1)\n                return;\n            item_1 === null || item_1 === void 0 ? void 0 : item_1.negate();\n            this.redoStack.push(item_1);\n            return item_1;\n        }\n        // else undo the specific item\n        var index = this.undoStack.findIndex(function (i) { return i === item; });\n        if (index === -1)\n            return;\n        this.undoStack.splice(index, 1);\n        item.negate();\n        this.redoStack.push(item);\n        return item;\n    };\n    HistoryImpl.prototype.redo = function (item) {\n        if (!item) {\n            var item_2 = this.redoStack.pop();\n            if (!item_2)\n                return;\n            item_2 === null || item_2 === void 0 ? void 0 : item_2.perform();\n            this.undoStack.push(item_2);\n            return item_2;\n        }\n        var index = this.redoStack.findIndex(function (i) { return i === item; });\n        if (index === -1)\n            return;\n        this.redoStack.splice(index, 1);\n        item.perform();\n        this.undoStack.push(item);\n        return item;\n    };\n    HistoryImpl.prototype.reset = function () {\n        this.undoStack.splice(0);\n        this.redoStack.splice(0);\n    };\n    return HistoryImpl;\n}());\nvar history = new HistoryImpl();\nexports.history = history;\nObject.freeze(history);\n"]},"metadata":{},"sourceType":"script"}